<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#3498db">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <title>Budget Tracker</title>

  <!-- CSS -->
  <link rel="stylesheet" href="/dashers-finance-manager/css/styles.css">

  <!-- Manifest -->
  <link rel="manifest" href="/dashers-finance-manager/manifest.json">

  <!-- Icons -->
  <link rel="apple-touch-icon" href="/dashers-finance-manager/assets/icons/icon-192.png">

  <!-- ChartJS -->
  <script src="/dashers-finance-manager/js/vendor/chart.umd.min.js"></script>

</head>

<body>

  <!-- Splash -->
  <div id="splashScreen">
    <div class="splash-inner">
      <img src="/dashers-finance-manager/assets/icons/icon-192.png" alt="Logo">
      <h1>Budget Tracker</h1>
      <div class="spinner"></div>
    </div>
  </div>

  <header>
    <h1>Budget Tracker</h1>
    <div class="header-actions">
      <button id="btnExport">Backup Data</button>
      <button id="btnImport">Restore Data</button>
    </div>
  </header>

  <nav>
    <ul>
      <li><a href="#dashboard" data-view="dashboard">ğŸ  Dashboard</a></li>
      <li><a href="#transactions" data-view="transactions">ğŸ’¸ Transactions</a></li>
      <li><a href="#budgets" data-view="budgets">ğŸ¯ Budgets</a></li>
      <li><a href="#accounts" data-view="accounts">ğŸ’³ Accounts</a></li>
      <li><a href="#categories" data-view="categories">ğŸ—‚ï¸ Categories</a></li>
      <li><a href="#reports" data-view="reports">ğŸ“Š Reports</a></li>
      <li><a href="#bills" data-view="bills">ğŸ§¾ Bills</a></li>
      <li><a href="#settings" data-view="settings">âš™ï¸ Settings</a></li>
      <li><a href="#calendar" data-view="calendar">ğŸ“… Calendar</a></li>
      <li><a href="#recurring" data-view="recurring">ğŸ” Recurring</a></li>
    </ul>
  </nav>

  <main id="mainContent"></main>

  <!-- Install Banner -->
  <div id="installBanner" class="install-banner hidden">
    <div class="install-banner-content">
      <strong>Install Budget Tracker</strong>
      <button id="installBtn" class="button">Install</button>
      <button id="installDismiss" class="button red">Dismiss</button>
    </div>
  </div>

  <!-- iOS Install Guide -->
  <div id="iosInstallGuide" class="ios-install-guide hidden">
    <div class="ios-install-content">
      <h3>Install on iPhone</h3>
      <p>Tap Share â†’ â€œAdd to Home Screenâ€</p>
      <button id="closeIosGuide" class="button">Got it</button>
    </div>
  </div>

  <!-- App scripts (GitHub Pages absolute paths) -->
  <script type="module" src="/dashers-finance-manager/js/app.js"></script>
  <script type="module" src="/dashers-finance-manager/js/dashboard_mobile.js"></script>

  <script>
    const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
    const isAndroid = /Android/.test(navigator.userAgent);

    console.log("Device:", { isIOS, isAndroid });

    // Register SW from correct path
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/dashers-finance-manager/serviceWorker.js", { scope: "/dashers-finance-manager/" })
        .then(reg => console.log("SW registered:", reg.scope))
        .catch(err => console.warn("SW FAILED:", err));
    }

    // Android install
    window.addEventListener('beforeinstallprompt', e => {
      e.preventDefault();
      window.deferredPrompt = e;
      document.getElementById("installBanner").classList.remove("hidden");
    });

    document.getElementById("installBtn")?.addEventListener("click", async () => {
      if (!window.deferredPrompt) return;
      window.deferredPrompt.prompt();
      window.deferredPrompt = null;
      document.getElementById("installBanner").classList.add("hidden");
    });

    document.getElementById("installDismiss")?.addEventListener("click", () =>
      document.getElementById("installBanner").classList.add("hidden")
    );

    // iOS install hint
    if (isIOS && !window.matchMedia('(display-mode: standalone)').matches) {
      document.getElementById("iosInstallGuide").classList.remove("hidden");
    }

    document.getElementById("closeIosGuide")?.addEventListener("click", () =>
      document.getElementById("iosInstallGuide").classList.add("hidden")
    );
  </script>

</body>
</html>
