<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#3498db">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <title>Budget Tracker</title>

  <!-- CSS -->
  <link rel="stylesheet" href="./css/styles.css">

  <!-- Manifest (GitHub Pages correct path) -->
  <link rel="manifest" href="./manifest.json">

  <!-- Icons -->
  <link rel="apple-touch-icon" href="./assets/icons/icon-192.png">

  <!-- Charts -->
  <script src="./js/vendor/chart.umd.min.js"></script>

</head>

<body>

  <!-- Splash -->
  <div id="splashScreen">
    <div class="splash-inner">
      <img src="./assets/icons/icon-192.png" alt="Logo">
      <h1>Budget Tracker</h1>
      <div class="spinner"></div>
    </div>
  </div>

  <header>
    <h1>Budget Tracker</h1>
    <div class="header-actions">
      <button id="btnExport">Backup Data</button>
      <button id="btnImport">Restore Data</button>
    </div>
  </header>

  <nav>
    <ul>
      <li><a href="#dashboard" data-view="dashboard"><span class="icon">ğŸ </span><span class="label">Dashboard</span></a></li>
      <li><a href="#transactions" data-view="transactions"><span class="icon">ğŸ’¸</span><span class="label">Transactions</span></a></li>
      <li><a href="#budgets" data-view="budgets"><span class="icon">ğŸ¯</span><span class="label">Budgets</span></a></li>
      <li><a href="#accounts" data-view="accounts"><span class="icon">ğŸ’³</span><span class="label">Accounts</span></a></li>
      <li><a href="#categories" data-view="categories"><span class="icon">ğŸ—‚ï¸</span><span class="label">Categories</span></a></li>
      <li><a href="#reports" data-view="reports"><span class="icon">ğŸ“Š</span><span class="label">Reports</span></a></li>
      <li><a href="#bills" data-view="bills"><span class="icon">ğŸ§¾</span><span class="label">Bills</span></a></li>
      <li><a href="#settings" data-view="settings"><span class="icon">âš™ï¸</span><span class="label">Settings</span></a></li>
      <li><a href="#calendar" data-view="calendar"><span class="icon">ğŸ“…</span><span class="label">Calendar</span></a></li>
      <li><a href="#recurring" data-view="recurring"><span class="icon">ğŸ”</span><span class="label">Recurring</span></a></li>
    </ul>
  </nav>

  <main id="mainContent"></main>

  <!-- Android Install Banner -->
  <div id="installBanner" class="install-banner hidden">
    <div class="install-banner-content">
      <strong>Install Budget Tracker</strong>
      <button id="installBtn" class="button">Install</button>
      <button id="installDismiss" class="button red">Dismiss</button>
    </div>
  </div>

  <!-- iOS Install Guide -->
  <div id="iosInstallGuide" class="ios-install-guide hidden">
    <div class="ios-install-content">
      <h3>Install on iPhone</h3>
      <p>Tap Share â†’ â€œAdd to Home Screenâ€</p>
      <button id="closeIosGuide" class="button">Got it</button>
    </div>
  </div>

  <!-- App JS (GitHub Pages correct path) -->
  <script type="module" src="./js/app.js"></script>
  <script type="module" src="./js/dashboard_mobile.js"></script>

  <script>
    // Device Detection
    const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
    const isAndroid = /Android/.test(navigator.userAgent);

    console.log("Device:", { isIOS, isAndroid });

    // Register Service Worker (GitHub Pages path)
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./serviceWorker.js", { scope: "./" })
        .then(reg => console.log("SW registered:", reg.scope))
        .catch(err => console.warn("SW FAILED:", err));
    }

    // Android install prompt
    window.addEventListener('beforeinstallprompt', e => {
      e.preventDefault();
      window.deferredPrompt = e;
      document.getElementById("installBanner").classList.remove("hidden");
    });

    document.getElementById("installBtn")?.addEventListener("click", async () => {
      if (!window.deferredPrompt) return;
      window.deferredPrompt.prompt();
      window.deferredPrompt = null;
      document.getElementById("installBanner").classList.add("hidden");
    });

    document.getElementById("installDismiss")?.addEventListener("click", () =>
      document.getElementById("installBanner").classList.add("hidden")
    );

    // iOS Install hint
    if (isIOS && !window.matchMedia('(display-mode: standalone)').matches) {
      document.getElementById("iosInstallGuide").classList.remove("hidden");
    }

    document.getElementById("closeIosGuide")?.addEventListener("click", () =>
      document.getElementById("iosInstallGuide").classList.add("hidden")
    );
  </script>

</body>
</html>
